<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0" />
    <title>클래식 회원 검색</title>

    <!-- CDN -->
    <script src="https://code.jquery.com/jquery-3.7.1.js" crossorigin="anonymous"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>

    <style>
        /* 레이아웃 */
        body {
            margin: 0;
            background: #f5f6f8;
            font-family: Arial, sans-serif;
        }

        #app {
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
            padding: 20px 12px;
            box-sizing: border-box;
        }

        .container {
            width: 1100px;
            max-width: 100%;
            background: #fff;
            border-radius: 14px;
            box-shadow: 0 6px 16px rgba(0, 0, 0, .08);
            padding: 20px;
        }

        /* 안내 문구 */
        .sub-txt {
            background: #f8fbff;
            border: 1px solid #e6f0ff;
            color: #334;
            padding: 12px 14px;
            border-radius: 8px;
            line-height: 1.6;
        }

        .sub-txt .warn {
            color: #c62828;
            font-weight: 700;
        }

        /* 선택 조건 박스 */
        .condition__box {
            margin-top: 16px;
            border: 1px solid #eef1f5;
            border-radius: 12px;
            padding: 14px;
        }

        .p_tit--type2 {
            margin: 0 0 10px 0;
            font-size: 1.05rem;
            font-weight: 700;
        }

        .condition__list ul {
            list-style: none;
            padding: 0;
            margin: 0;
            display: grid;
            grid-template-columns: repeat(4, minmax(0, 1fr));
            gap: 10px;
        }

        .condition__list li {
            background: #f8f9fb;
            border: 1px solid #eef1f5;
            border-radius: 10px;
            padding: 10px;
        }

        .condition__list h3 {
            margin: 0 0 6px;
            font-size: .95rem;
            color: #666;
        }

        .p_txt--type1 {
            margin: 0;
            font-weight: 600;
        }

        .research-btn {
            margin-top: 12px;
            display: inline-block;
            padding: 10px 16px;
            background: #3a7afe;
            color: #fff;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 700;
        }

        .research-btn:hover {
            background: #2b68ea;
        }

        /* 회원 리스트 */
        .member__list {
            margin-top: 18px;
            display: grid;
            grid-template-columns: repeat(4, minmax(0, 1fr));
            gap: 16px;
        }

        .member__box {
            border: 1px solid #e9edf3;
            border-radius: 12px;
            padding: 12px;
            background: #fff;
            cursor: pointer;
            transition: transform .12s ease, box-shadow .12s ease;
        }

        .member__box:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 16px rgba(44, 62, 80, .08);
        }

        .member__photo {
            display: flex;
            gap: 12px;
            align-items: center;
            margin-bottom: 10px;
        }

        .member__photo img {
            width: 66px;
            height: 76px;
            object-fit: cover;
            border-radius: 8px;
            border: 1px solid #eee;
        }

        .member__name {
            font-weight: 700;
            color: #333;
        }

        .member__profile {
            list-style: none;
            padding: 0;
            margin: 8px 0 0;
            display: grid;
            grid-template-columns: repeat(2, minmax(0, 1fr));
            gap: 6px;
            font-size: .92rem;
        }

        .member__profile li {
            background: #f8fafc;
            border: 1px solid #eef1f5;
            border-radius: 8px;
            padding: 6px;
            text-align: center;
        }

        .member-num {
            grid-column: 1 / -1;
        }

        .plus_profile {
            margin: 8px 0 0;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            background: #eaf1ff;
            color: #3a7afe;
            font-weight: 900;
            user-select: none;
        }

        /* 더보기 버튼 */
        .btn__wrap {
            text-align: center;
            margin-top: 18px;
        }

        .add-btn {
            display: inline-block;
            padding: 10px 18px;
            border: 1px solid #c8d4ff;
            background: #fff;
            color: #3a7afe;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 700;
        }

        .add-btn:hover {
            background: #f4f7ff;
        }

        /* 목록(테이블) 레이아웃 */
        .table-wrap {
            margin-top: 18px;
            border: 1px solid #e9edf3;
            border-radius: 12px;
            overflow: auto;
            /* 가로 스크롤 */
            background: #fff;
        }

        /* 가로로 길게: 최소 폭 넉넉히 */
        .member-table {
            width: 1400px;
            /* 필요하면 1200~1800px로 조절 */
            min-width: 100%;
            border-collapse: collapse;
            table-layout: fixed;
            /* 셀 폭 균등 */
        }

        .member-table th,
        .member-table td {
            border: 1px solid #e5e9f2;
            padding: 10px 12px;
            text-align: center;
            white-space: nowrap;
            /* 줄바꿈 방지 */
        }

        .member-table th {
            position: sticky;
            top: 0;
            /* 헤더 고정 */
            background: #f6f9ff;
            z-index: 1;
            font-weight: 700;
        }

        .member-table tr:nth-child(even) td {
            background: #fafcff;
        }

        .member-table tr:hover td {
            background: #f0f6ff;
        }

        .member-table .photo-cell img {
            width: 48px;
            height: 56px;
            object-fit: cover;
            border-radius: 6px;
            border: 1px solid #eee;
        }

        .mini-btn {
            padding: 6px 10px;
            border: 1px solid #c8d4ff;
            background: #fff;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            color: #3a7afe;
        }

        .mini-btn:hover {
            background: #eef3ff;
        }


        /* 반응형 */
        @media (max-width: 1100px) {
            .member__list {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        @media (max-width: 820px) {
            .member__list {
                grid-template-columns: repeat(2, 1fr);
            }

            .condition__list ul {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 520px) {
            .member__list {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>

<body>
    <div id="app">
        <div class="container">
            <!-- 안내 -->
            <p class="sub-txt">
                클래식회원검색은 듀오 회원 중 <span class="warn">프로필 공개에 동의한 일부 회원정보만 노출</span>되며, 동성의 경우 검색되지 않습니다.
            </p>

            <!-- 선택 조건 -->
            <div class="condition__box">
                <p class="p_tit--type2">선택하신 조건</p>
                <div class="condition__list">
                    <ul>
                        <li>
                            <div>
                                <h3>연령</h3>
                                <p class="p_txt--type1">{{ condition.ageLabel }}</p>
                            </div>
                        </li>
                        <li>
                            <div>
                                <h3>직업</h3>
                                <p class="p_txt--type1">{{ condition.job || '무관' }}</p>
                            </div>
                        </li>
                        <li>
                            <div>
                                <h3>거주지</h3>
                                <p class="p_txt--type1">{{ condition.region || '무관' }}</p>
                            </div>
                        </li>
                        <li>
                            <div>
                                <h3>학력</h3>
                                <p class="p_txt--type1">{{ condition.edu || '무관' }}</p>
                            </div>
                        </li>
                    </ul>

                    <!-- 다시검색 버튼: 기존 흐름 유지 -->
                    <input type="button" class="research-btn" value="다시검색" @click="goSearchPage">
                </div>
            </div>

            <!-- 회원 리스트 -->
            <!-- 회원 리스트 -->
            <div class="member__list" id="search_list">
                <!-- DB에서 받아온 목록이 있으면: 기존 v-for 렌더링 -->
                <template v-if="members.length > 0">
                    <div class="member__box" v-for="m in members" :key="m.memberNo" @click="goDetail(m.memberNo)">
                        <div class="member__photo" id="watermark">
                            <img :src="m.photo || defaultPhoto" :alt="m.memberNo" />
                            <div>
                                <div class="member__name">{{ m.memberNo }} <span v-if="m.name">/ {{ m.name }}</span>
                                </div>
                            </div>
                        </div>

                        <ul class="member__profile">
                            <li class="member-num">
                                <h3>회원번호</h3>
                                <p class="p_txt--type2">{{ m.memberNo }}</p>
                            </li>
                            <li>
                                <h3>출생년</h3>
                                <p class="p_txt--type2">{{ m.birthYear }}년</p>
                            </li>
                            <li>
                                <h3>결혼경력</h3>
                                <p class="p_txt--type2">{{ m.marital }}</p>
                            </li>
                            <li>
                                <h3>직업</h3>
                                <p class="p_txt--type2">{{ m.job }}</p>
                            </li>
                            <li>
                                <h3>거주지</h3>
                                <p class="p_txt--type2">{{ m.region }}</p>
                            </li>
                            <li v-if="m.profileViewedAt">
                                <h3>프로필 열람일</h3>
                                <p class="p_txt--type2">{{ m.profileViewedAt }}</p>
                            </li>
                        </ul>

                        <p class="plus_profile" @click.stop="goDetail(m.memberNo)">+</p>
                    </div>
                </template>

                <!-- DB가 비어있으면: 하드코딩 카드 5개 노출 -->
                <template v-else>
                    <div class="member__box" @click="goDetail('F0001')">
                        <div class="member__photo" id="watermark">
                            <img src="/html/memberSearch/img/img_profile_none_w.jpg" alt="F0001" />
                            <div>
                                <div class="member__name">F0001 / 김가은</div>
                            </div>
                        </div>
                        <ul class="member__profile">
                            <li class="member-num">
                                <h3>회원번호</h3>
                                <p class="p_txt--type2">F0001</p>
                            </li>
                            <li>
                                <h3>출생년</h3>
                                <p class="p_txt--type2">1992년</p>
                            </li>
                            <li>
                                <h3>결혼경력</h3>
                                <p class="p_txt--type2">초혼</p>
                            </li>
                            <li>
                                <h3>직업</h3>
                                <p class="p_txt--type2">교육/공무원직</p>
                            </li>
                            <li>
                                <h3>거주지</h3>
                                <p class="p_txt--type2">서울권</p>
                            </li>
                            <li>
                                <h3>프로필 열람일</h3>
                                <p class="p_txt--type2">2025.01.27</p>
                            </li>
                        </ul>
                        <p class="plus_profile" @click.stop="goDetail('F0001')">+</p>
                    </div>

                    <div class="member__box" @click="goDetail('F0002')">
                        <div class="member__photo" id="watermark">
                            <img src="/html/memberSearch/img/img_profile_none_w.jpg" alt="F0002" />
                            <div>
                                <div class="member__name">F0002 / 이지훈</div>
                            </div>
                        </div>
                        <ul class="member__profile">
                            <li class="member-num">
                                <h3>회원번호</h3>
                                <p class="p_txt--type2">F0002</p>
                            </li>
                            <li>
                                <h3>출생년</h3>
                                <p class="p_txt--type2">1988년</p>
                            </li>
                            <li>
                                <h3>결혼경력</h3>
                                <p class="p_txt--type2">초혼</p>
                            </li>
                            <li>
                                <h3>직업</h3>
                                <p class="p_txt--type2">전문/기술/의료직</p>
                            </li>
                            <li>
                                <h3>거주지</h3>
                                <p class="p_txt--type2">경기권</p>
                            </li>
                            <li>
                                <h3>프로필 열람일</h3>
                                <p class="p_txt--type2">2025.01.28</p>
                            </li>
                        </ul>
                        <p class="plus_profile" @click.stop="goDetail('F0002')">+</p>
                    </div>

                    <div class="member__box" @click="goDetail('F0003')">
                        <div class="member__photo" id="watermark">
                            <img src="/html/memberSearch/img/img_profile_none_w.jpg" alt="F0003" />
                            <div>
                                <div class="member__name">F0003 / 박서윤</div>
                            </div>
                        </div>
                        <ul class="member__profile">
                            <li class="member-num">
                                <h3>회원번호</h3>
                                <p class="p_txt--type2">F0003</p>
                            </li>
                            <li>
                                <h3>출생년</h3>
                                <p class="p_txt--type2">1994년</p>
                            </li>
                            <li>
                                <h3>결혼경력</h3>
                                <p class="p_txt--type2">초혼</p>
                            </li>
                            <li>
                                <h3>직업</h3>
                                <p class="p_txt--type2">일반사무직</p>
                            </li>
                            <li>
                                <h3>거주지</h3>
                                <p class="p_txt--type2">충청권</p>
                            </li>
                            <li>
                                <h3>프로필 열람일</h3>
                                <p class="p_txt--type2">2025.01.26</p>
                            </li>
                        </ul>
                        <p class="plus_profile" @click.stop="goDetail('F0003')">+</p>
                    </div>

                    <div class="member__box" @click="goDetail('F0004')">
                        <div class="member__photo" id="watermark">
                            <img src="/html/memberSearch/img/img_profile_none_w.jpg" alt="F0004" />
                            <div>
                                <div class="member__name">F0004 / 최민수</div>
                            </div>
                        </div>
                        <ul class="member__profile">
                            <li class="member-num">
                                <h3>회원번호</h3>
                                <p class="p_txt--type2">F0004</p>
                            </li>
                            <li>
                                <h3>출생년</h3>
                                <p class="p_txt--type2">1987년</p>
                            </li>
                            <li>
                                <h3>결혼경력</h3>
                                <p class="p_txt--type2">초혼</p>
                            </li>
                            <li>
                                <h3>직업</h3>
                                <p class="p_txt--type2">사업/특수직/기타</p>
                            </li>
                            <li>
                                <h3>거주지</h3>
                                <p class="p_txt--type2">영남권</p>
                            </li>
                            <li>
                                <h3>프로필 열람일</h3>
                                <p class="p_txt--type2">2025.01.25</p>
                            </li>
                        </ul>
                        <p class="plus_profile" @click.stop="goDetail('F0004')">+</p>
                    </div>

                    <div class="member__box" @click="goDetail('F0005')">
                        <div class="member__photo" id="watermark">
                            <img src="/html/memberSearch/img/img_profile_none_w.jpg" alt="F0005" />
                            <div>
                                <div class="member__name">F0005 / 한지민</div>
                            </div>
                        </div>
                        <ul class="member__profile">
                            <li class="member-num">
                                <h3>회원번호</h3>
                                <p class="p_txt--type2">F0005</p>
                            </li>
                            <li>
                                <h3>출생년</h3>
                                <p class="p_txt--type2">1990년</p>
                            </li>
                            <li>
                                <h3>결혼경력</h3>
                                <p class="p_txt--type2">초혼</p>
                            </li>
                            <li>
                                <h3>직업</h3>
                                <p class="p_txt--type2">전문/기술/의료직</p>
                            </li>
                            <li>
                                <h3>거주지</h3>
                                <p class="p_txt--type2">서울권</p>
                            </li>
                            <li>
                                <h3>프로필 열람일</h3>
                                <p class="p_txt--type2">2025.01.24</p>
                            </li>
                        </ul>
                        <p class="plus_profile" @click.stop="goDetail('F0005')">+</p>
                    </div>
                </template>
            </div>


            <!-- 더보기 -->
            <div class="btn__wrap">
                <input type="button" value="+ 더보기" class="white-btn add-btn" id="more_btn"
                    :disabled="loading || !hasMore" @click="loadMore">
            </div>
        </div>
    </div>

    <script>
        const { createApp } = Vue;

        createApp({
            data() {
                return {
                    // 조건(검색 페이지에서 넘어오는 파라미터 기준으로 세팅을 가정)
                    condition: {
                        ageMin: null,   // 예: 30
                        ageMax: null,   // 예: 39
                        job: null,    // 예: "교육/공무원직"
                        region: null,    // 예: "서울권"
                        edu: null     // 예: "대졸 이상"
                    },

                    // 리스트 데이터
                    members: [],

                    // 페이지네이션
                    page: 1,
                    pageSize: 12,
                    hasMore: true,
                    loading: false,

                    // 기본 이미지
                    defaultPhoto: "/html/memberSearch/img/img_profile_none_w.jpg"
                };
            },

            computed: {
                // 연령 라벨
                ageLabel() {
                    const { ageMin, ageMax } = this.condition;
                    if (!ageMin && !ageMax) return "무관";
                    if (ageMin && ageMax) return `${ageMin} ~ ${ageMax}세`;
                    if (ageMin) return `${ageMin}세 이상`;
                    return `${ageMax}세 이하`;
                }
            },

            methods: {
                // 다시검색: 기존 ASP 페이지로 이동(유지)
                goSearchPage() {
                    location.href = "classic_member_search.asp";
                },

                // 상세 이동(기존 openWindowProfile 대체)
                goDetail(memberNo) {
                    // 새 창/팝업이 필요하면 window.open 사용
                    // window.open(`/profile/${memberNo}`, "_blank", "width=980,height=800");
                    // 일단은 단순 이동으로 처리
                    location.href = `/profile/${memberNo}`;
                },

                // 목록 조회
                fetchMembers(reset = false) {
                    if (this.loading) return;
                    this.loading = true;

                    if (reset) {
                        this.page = 1;
                        this.members = [];
                        this.hasMore = true;
                    }

                    const url = "http://localhost:3009/api/members";
                    const params = {
                        ageMin: this.condition.ageMin || "",
                        ageMax: this.condition.ageMax || "",
                        job: this.condition.job || "",
                        region: this.condition.region || "",
                        edu: this.condition.edu || "",
                        page: this.page,
                        pageSize: this.pageSize
                    };

                    $.ajax({
                        url,
                        type: "GET",
                        dataType: "json",
                        data: params,
                        success: (data) => {
                            const list = data?.list || [];
                            // 데이터 스키마 매핑(백엔드와 이름 다르면 여기서 조정)
                            const mapped = list.map(x => ({
                                memberNo: x.memberNo,
                                name: x.name, // 없으면 표시 안됨
                                birthYear: x.birthYear,
                                marital: x.marital,
                                job: x.job,
                                region: x.region,
                                profileViewedAt: x.profileViewedAt,
                                photo: x.photo
                            }));

                            this.members = [...this.members, ...mapped];
                            this.hasMore = Boolean(data?.hasMore);
                            if (this.hasMore) this.page += 1;
                        },
                        error: (xhr) => {
                            console.error("회원 목록 API 오류:", xhr?.responseText || xhr);
                            alert("회원 목록을 불러오지 못했습니다.");
                        },
                        complete: () => {
                            this.loading = false;
                        }
                    });
                },

                loadMore() {
                    this.fetchMembers(false);
                },

                // 쿼리스트링으로 넘어온 조건 세팅(옵션)
                initConditionFromQuery() {
                    const params = new URLSearchParams(location.search);
                    const toNum = (v) => {
                        const n = Number(v); return isNaN(n) ? null : n;
                    };
                    this.condition.ageMin = params.get("ageMin") ? toNum(params.get("ageMin")) : null;
                    this.condition.ageMax = params.get("ageMax") ? toNum(params.get("ageMax")) : null;
                    this.condition.job = params.get("job") || null;
                    this.condition.region = params.get("region") || null;
                    this.condition.edu = params.get("edu") || null;
                }
            },

            mounted() {
                // (선택) 검색 페이지에서 파라미터로 넘어온 조건 반영
                this.initConditionFromQuery();

                // 첫 로드
                this.fetchMembers(true);
            }
        }).mount("#app");
    </script>
</body>

</html>